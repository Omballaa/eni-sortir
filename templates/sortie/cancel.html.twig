{% extends 'base.html.twig' %}

{% block title %}Annuler {{ sortie.nom }} - ENI Sorties{% endblock %}

{% block body %}
<div class="container-fluid py-3">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0">
                        <i class="fas fa-ban me-2"></i>Annuler une sortie
                    </h4>
                </div>
                <div class="card-body">
                    <!-- Informations de la sortie -->
                    <div class="alert alert-warning">
                        <h5><i class="fas fa-exclamation-triangle me-2"></i>Attention</h5>
                        <p class="mb-0">
                            Vous êtes sur le point d'annuler la sortie <strong>"{{ sortie.nom }}"</strong>.
                            {% if sortie.nbInscriptions > 0 %}
                                Cette action affectera <strong>{{ sortie.nbInscriptions }} participant(s)</strong> déjà inscrit(s).
                            {% endif %}
                        </p>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6 class="card-title">Détails de la sortie</h6>
                                    <ul class="list-unstyled mb-0">
                                        <li><strong>Nom :</strong> {{ sortie.nom }}</li>
                                        <li><strong>Date :</strong> {{ sortie.dateHeureDebut|date('d/m/Y à H:i') }}</li>
                                        <li><strong>Lieu :</strong> {{ sortie.lieu.nomLieu }}, {{ sortie.lieu.ville.nomVille }}</li>
                                        <li><strong>Organisateur :</strong> {{ sortie.organisateur.prenom }} {{ sortie.organisateur.nom }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6 class="card-title">Participants</h6>
                                    {% if sortie.nbInscriptions > 0 %}
                                        <p class="mb-2">
                                            <span class="badge bg-primary">{{ sortie.nbInscriptions }}</span> 
                                            participant(s) inscrit(s) sur {{ sortie.nbInscriptionsMax }} places
                                        </p>
                                        <small class="text-muted">
                                            Tous les participants inscrits seront automatiquement notifiés de l'annulation.
                                        </small>
                                    {% else %}
                                        <p class="text-muted mb-0">Aucun participant inscrit</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Formulaire d'annulation -->
                    {{ form_start(form) }}
                    
                    <div class="mb-4">
                        {{ form_row(form.motifAnnulation, {
                            label: 'Motif de l\'annulation',
                            help: 'Ce motif sera visible par tous les participants. Soyez précis et courtois.',
                            attr: {
                                'rows': 4,
                                'placeholder': 'Expliquez le motif de l\'annulation de cette sortie...'
                            }
                        }) }}
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Conséquences de l'annulation :</strong>
                        <ul class="mb-0 mt-2">
                            <li>La sortie passera à l'état "Annulée"</li>
                            <li>Aucune nouvelle inscription ne sera possible</li>
                            {% if sortie.nbInscriptions > 0 %}
                                <li>Les participants inscrits recevront une notification d'annulation</li>
                                <li>Toutes les inscriptions existantes seront conservées pour traçabilité</li>
                            {% endif %}
                        </ul>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ path('app_sortie_show', {id: sortie.id}) }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>Retour à la sortie
                        </a>
                        
                        <button type="submit" class="btn btn-danger" 
                                onclick="return confirm('Êtes-vous certain de vouloir annuler cette sortie ? Cette action est irréversible.')">
                            <i class="fas fa-ban me-1"></i>Confirmer l'annulation
                        </button>
                    </div>
                    
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const motifTextarea = document.querySelector('#cancel_sortie_motifAnnulation');
    
    if (motifTextarea) {
        // Auto-resize du textarea
        motifTextarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
        
        // Validation du motif
        motifTextarea.addEventListener('blur', function() {
            const motif = this.value.trim();
            if (motif.length < 10) {
                this.setCustomValidity('Le motif doit contenir au moins 10 caractères');
            } else if (motif.length > 500) {
                this.setCustomValidity('Le motif ne peut pas dépasser 500 caractères');
            } else {
                this.setCustomValidity('');
            }
        });
    }
});
</script>
{% endblock %}